<!DOCTYPE html>
<html>

  <head>
	<meta name="generator" content="Hugo 0.117.0">

  <title>
      
      Eric Gregorich | Architect
      
  </title>

</head>


  <body>

    

	
<div class="h-feed">

	
	
	  <div class="h-entry">
		
			<h1><a href="https://eg-architect.micro.blog/2024/03/11/bypass-first-access.html">Bypass first access consent dialog in Power Apps</a></h1>
		

		<a href="https://eg-architect.micro.blog/2024/03/11/bypass-first-access.html" class="u-url"><time class="dt-published" datetime="2024-03-11 20:54:45 -0400">Mar 11, 2024</time></a>

		<div class="e-content">
			 <p>How to use PowerShell to disable the consent dialog showing when a user opens Power Apps for the first time or when a new connection is added.</p>
<h2 id="set-consent-bypass">Set Consent Bypass</h2>
<p>PowerShell can disable the consent dialog when the user opens the Power App for the first time or when a new connection is added.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Force
</span></span><span style="display:flex;"><span>dir . | Unblock-File
</span></span><span style="display:flex;"><span>Install-Module -Name Microsoft.PowerApps.Administration.PowerShell
</span></span><span style="display:flex;"><span>Install-Module -Name Microsoft.PowerApps.PowerShell -AllowClobber
</span></span><span style="display:flex;"><span>Import-Module Microsoft.Online.SharePoint.Powershell -Verbose
</span></span><span style="display:flex;"><span>Connect-SPOService -Url <span style="color:#f92672">{</span>Your SharePoint Admin Tenant URL<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>Set-AdminPowerAppApisToBypassConsent -AppName <span style="color:#f92672">{</span>Your App ID<span style="color:#f92672">}</span>
</span></span></code></pre></div><p>When prompted, enter your Environment ID in the URL or the Power Platform Admin center in the selected Environment.</p>
<h2 id="clear-consent-bypass">Clear Consent Bypass</h2>
<p>The following PowerShell clears the consent bypass that is set. The users will again be prompted for consent when they open the app for the first time or if a new connection is added.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Clear-AdminPowerAppApisToBypassConsent -AppName <span style="color:#f92672">{</span>Your App Id<span style="color:#f92672">}</span>
</span></span></code></pre></div>
		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://eg-architect.micro.blog/2024/03/09/using-stored-procedures.html">Calling Stored Procedures directly from Power Apps</a></h1>
		

		<a href="https://eg-architect.micro.blog/2024/03/09/using-stored-procedures.html" class="u-url"><time class="dt-published" datetime="2024-03-09 18:04:58 -0400">Mar 9, 2024</time></a>

		<div class="e-content">
			 <p>As of March 9, 2024, Microsoft has released the ability to call SQL Stored Procedures directly from within a Power App. This is a massive improvement for anyone using Power Apps with SQL! Previously, if we wanted to use stored procedures, our app would need to execute a Power Automate Flow, which would call the stored procedure, then we would return the Response to the Power App. This was tedious, slow, and required a premium license.</p>
<blockquote>
<p>This feature is in Preview and should be Generally Available in the coming months. It&rsquo;s not recommended to use this for production apps at this time. However, this is definitely a feature you&rsquo;ll want to implement if you use stored procedures in your solutions.</p>
</blockquote>
<h2 id="enable-the-feature">Enable the feature</h2>
<ul>
<li>Edit your Power App.</li>
<li>Open <strong>Settings</strong>.</li>
<li>Under <strong>Upcoming Features</strong>, enable <code>SQL Server stored procedures</code>.</li>
</ul>
<h2 id="add-your-stored-procedure">Add your stored procedure</h2>
<ul>
<li>Edit your Power App.</li>
<li>Open <strong>Data</strong>.</li>
<li>Click <strong>Add Data</strong>.</li>
<li>Select <strong>SQL Server</strong>.</li>
<li>Select your <strong>SQL Server Connection</strong>.</li>
<li>A panel will open on the right. Select the Stored Procedures tab.</li>
<li>Find your stored procedure(s) and select them.</li>
<li>Click Connect to add them to your app.</li>
</ul>
<h2 id="calling-your-stored-procedure">Calling your Stored Procedure</h2>
<p>Calling your stored procedure is pretty simple. In your formula, start typing the name of your stored procedure. The database name and stored procedure name will appear.</p>
<p>If your stored procedure has any input parameters, you&rsquo;ll need to include them. You will also want to save your results to a variable or collection so that you can use it in your app.</p>
<pre tabindex="0"><code>UpdateContext(
{
    tmpResult: DBName.dboSaveItems(
    {
        MyCustomItems: JSON(colMyCustomItems),
        MyCustomDetails:JSON(colMyCustomDetails)
    }
    ).ResultSets
}
);
</code></pre><p>In my example, DBName is the fake name of my database, dboSaveItems is the fake name of my stored procedure. My stored procedure takes two input parameters, MyCustomItems, and MyCustomDetails. These parameters are expecting JSON. Long story short, I&rsquo;m taking the data in my app, patching it to a collection, then converting it to JSON and passing it to the Stored Procedure. The Stored Procedure parses this JSON, saves all the data, and returns the results. All of this is run in a Transaction, which means if there are any errors, everything is rolled back.</p>
<p>The main point is, I&rsquo;m calling my procedure and passing in my input parameters. The stored procedure then returns the results. In my current production apps, we do the same thing, except we pass this JSON to a Power Automate Flow, which calls the stored procedure, then returns the results to the app.</p>
<h2 id="reading-your-results">Reading your results.</h2>
<p>This is where things can get tricky.</p>
<p>Your results are returned as an <a href="https://learn.microsoft.com/en-us/power-platform/power-fx/untyped-object">Untyped Object</a>.  Power Apps can handle this data type, but not as elegantly as other types. In short, you have no IntelliSense that would normally make it easy to use your results simply by typing the name of the properties you want to reference.</p>
<p>Your stored procedure may return a wide variety of things, from single output parameters, to entire tables of data.</p>
<p>You need to know what the results look like in order to read the values. To achieve this, open your <strong>Monitor tool</strong>, then execute your Stored Procedure. Look at the results of this execution in the Monitor Tool.</p>
<p>Here are the results from this example stored procedure, which returns a single text value containing the new ID of the item that was created.</p>
<pre tabindex="0"><code>&#34;body&#34;: {
    &#34;ResultSets&#34;: {
        &#34;Table1&#34;: [
            {
                &#34;ItemId&#34;: 24567
            }
        ]
    },
    &#34;OutputParameters&#34;: {}
}
</code></pre><p>To fetch the value of my ItemId column from tmpResult, I&rsquo;d need to write a formula that finds the specific column and converts the value into whatever DataType it is.</p>
<pre tabindex="0"><code>Text(Index(Table(tmpResult.Table1), 1 ).Value.ItemId )
</code></pre><p>The above example converts Table1 into a Table object, then gets the first row of the table using the Index function. Finally, we get the value and convert the ItemId column to text.</p>
<p>If my column Data Type were a number, I would use Value() instead of Text(). If it were a date, I&rsquo;d use DateValue(), and so on.</p>
<p>The result of my formula is <code>24567</code>.</p>
<p><strong>What if I want to return a collection of data from my stored procedure?</strong>
In this scenario, my stored procedure returns a collection of data that I intend to use in my app. Calling the stored procedure is essentially the same.</p>
<p>I&rsquo;ll add a button to my page that will be used to execute the stored procedure and return the results into a collection that I can use elsewhere in my app, perhaps a Gallery, Table, or a Combo box control.</p>
<p>The first part of my formula triggers the stored procedure and returns the results.</p>
<pre tabindex="0"><code>UpdateContext({tmpItemStatusValues: DBName.dboGetItemStatusTypes().ResultSets});
</code></pre><p>Again, execute your stored procedure while using the Monitor Tool. Read the results. You should see something that resembles the following, only with your data.</p>
<pre tabindex="0"><code>&#34;body&#34;: {
    &#34;ResultSets&#34;: {
        &#34;Table1&#34;: [
            {
                &#34;Id&#34;: &#34;6F5A10C4-5D6B-4091-A439-45D4DC141A99&#34;,
                &#34;WhenCreated&#34;: &#34;2022-09-30T15:28:41.2066667&#34;,
                &#34;WhenModified&#34;: &#34;2023-01-05T13:46:56.56&#34;,
                &#34;Name&#34;: &#34;Pending&#34;,
                &#34;Description&#34;: &#34;This item is pending&#34;,
                &#34;SortOrder&#34;: 1,
                &#34;IsActive&#34;: true
            },
            {
                &#34;Id&#34;: &#34;7B21644F-C4D1-45DD-BAA1-17533C64895B&#34;,
                &#34;WhenCreated&#34;: &#34;2022-09-30T15:28:41.2066667&#34;,
                &#34;WhenModified&#34;: &#34;2023-01-05T13:46:56.61&#34;,
                &#34;Name&#34;: &#34;Complete&#34;,
                &#34;Description&#34;: &#34;This item is complete&#34;,
                &#34;SortOrder&#34;: 2,
                &#34;IsActive&#34;: true
            }
        ]
    },
</code></pre><p>The important part is the structure itself. You have <strong>Table1</strong> returned as a nested node under <strong>ResultSet</strong>. Since I&rsquo;m saving ResultSet to my variable, <strong>tmpItemStatusValues</strong>, I now need to write a formula to read it and convert it into something usable.</p>
<p>Some controls, like the Gallery, we can simply add our Table1 directly into the control Data Source and start using it. Unfortunately, if we want to use it elsewhere as a Typed object (with IntelliSense) we&rsquo;ll need to convert the results.</p>
<p>Next, update your button&rsquo;s <code>OnSelect</code> property to include the For All ForAll function. We&rsquo;re looping through, our returned data and converting each field into a usable Data Type that we can use in the app. The results are saved to a new collection named <code>colItemStatusValues</code>.</p>
<pre tabindex="0"><code>UpdateContext({tmpItemStatusValues: DBName.dboGetItemStatusTypes().ResultSets});

ClearCollect(
    colItemStatusValues,
    ForAll(
        tmpItemStatusValues.Table1,
        {
            Name: Text(ThisRecord.Name),
            Description: Text(ThisRecord.Description),
            Id: GUID(ThisRecord.Id)
        }
    )
)
</code></pre><p>We can now use the <code>colItemStatusValues</code> collection as we do any other collection in our app!</p>
<h2 id="conclusion">Conclusion</h2>
<p>I&rsquo;m certain there are other ways to handle this, and I&rsquo;m learning them as I go. As a quick recap, I demonstrated how to execute a stored procedure directly from a Power App and convert the result into something we can use in our app. This bypasses the need to use Power Automate to call stored procedures, which makes things faster and more efficient.</p>

		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://eg-architect.micro.blog/2024/03/01/power-apps-error.html">Power Apps Error Handling when using the Patch function</a></h1>
		

		<a href="https://eg-architect.micro.blog/2024/03/01/power-apps-error.html" class="u-url"><time class="dt-published" datetime="2024-03-01 16:07:52 -0400">Mar 1, 2024</time></a>

		<div class="e-content">
			 <p>When using the Patch Function to save data to a data source, such as Dataverse, or SQL, our user will see a red error bar at the top of the screen if any unhandled errors occur.</p>
<blockquote>
<p>One of the most important reasons we want to include our own error handling is so we can control the user experience. We may want to cancel further operations from executing, or log the errors in a unqiue way. We don&rsquo;t have this control if we don&rsquo;t capture our errors!</p>
</blockquote>
<p>For example, let&rsquo;s create a simple Dataverse table with the required columns, Name, Date Entered, and Details. If you try to use Patch to insert a record into this table without providing a value for a required field, you will receive an error.</p>
<p>Here is our formula for creating this scenario:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">Patch</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;Demo Table&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Defaults</span>(<span style="color:#e6db74">&#39;Demo Table&#39;</span>),
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">txtName</span>.<span style="color:#a6e22e">Value</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Date Entered&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dteDateEntered</span>.<span style="color:#a6e22e">SelectedDate</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Details</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">txtDetails</span>.<span style="color:#a6e22e">Value</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Reset</span>(<span style="color:#a6e22e">txtName</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Reset</span>(<span style="color:#a6e22e">txtDetails</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Reset</span>(<span style="color:#a6e22e">dteDateEntered</span>)
</span></span></code></pre></div><!-- raw HTML omitted -->
<p>The error returned: <code>Network error when using Patch function: Field 'tpa_dateentered' is required</code> is helpful enough, but not enough.</p>
<p>If we look at the Monitoring Tool, we can see the details of our error.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Obviously, we want to validate our fields before we even execute the Patch Function, but for the purposes of this example, I&rsquo;ll add some error handling to our formula to demonstrate what&rsquo;s possible.</p>
<p>Let&rsquo;s update our code with the <a href="https://learn.microsoft.com/en-us/power-platform/power-fx/reference/function-iferror#iserror">IsError</a> function, which will let us capture the error before it is presented to the user and then do something else if an error occurs.</p>
<p>In this example, I&rsquo;m capturing the error and using the Trace function to write out the details of the error to the Monitor tool (or Azure Application Insights if you have it enabled).</p>
<p>When using the IsError function, we&rsquo;ll have this structure:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">If</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">IsError</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Use your Patch function here.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ),
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">true</span> <span style="color:#75715e">// Do something if there is an error.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">false</span> <span style="color:#75715e">// Do something else (or nothing) if there are no errors
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)
</span></span></code></pre></div><p>Using this structure, our updated code would look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">If</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">IsError</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Patch</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;Demo Table&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Defaults</span>(<span style="color:#e6db74">&#39;Demo Table&#39;</span>),
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">txtName</span>.<span style="color:#a6e22e">Value</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Date Entered&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dteDateEntered</span>.<span style="color:#a6e22e">SelectedDate</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Details</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">txtDetails</span>.<span style="color:#a6e22e">Value</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Notify</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">First</span>(<span style="color:#a6e22e">Errors</span>(<span style="color:#e6db74">&#39;Demo Table&#39;</span>)).<span style="color:#a6e22e">Message</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">NotificationType</span>.Error
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Trace</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Error saving to Demo Table&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">TraceSeverity</span>.Error,
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Screen</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">App</span>.<span style="color:#a6e22e">ActiveScreen</span>.<span style="color:#a6e22e">Name</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">User</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">User</span>().<span style="color:#a6e22e">Email</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Message</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">First</span>(<span style="color:#a6e22e">Errors</span>(<span style="color:#e6db74">&#39;Demo Table&#39;</span>)).<span style="color:#a6e22e">Message</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Column</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">First</span>(<span style="color:#a6e22e">Errors</span>(<span style="color:#e6db74">&#39;Demo Table&#39;</span>)).<span style="color:#a6e22e">Column</span>,
</span></span><span style="display:flex;"><span>            Error<span style="color:#f92672">:</span> <span style="color:#a6e22e">First</span>(<span style="color:#a6e22e">Errors</span>(<span style="color:#e6db74">&#39;Demo Table&#39;</span>)).Error
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Notify</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Success&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">NotificationType</span>.<span style="color:#a6e22e">Success</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Reset</span>(<span style="color:#a6e22e">txtName</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Reset</span>(<span style="color:#a6e22e">txtDetails</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Reset</span>(<span style="color:#a6e22e">dteDateEntered</span>)
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>If an error occurs, we&rsquo;re using a Trace function to write details to our logs. If no errors occur, we show a Success message and then reset the controls.</p>
<p>We can see the details of our error in the Monitor Tool.</p>
<!-- raw HTML omitted -->
<p>Most importantly, we can stop the next operation from executing, which could cause cascading issues that are all triggered by the first error.</p>

		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://eg-architect.micro.blog/2024/02/26/azure-app-registration.html">Azure App Registration for Select SharePoint Sites</a></h1>
		

		<a href="https://eg-architect.micro.blog/2024/02/26/azure-app-registration.html" class="u-url"><time class="dt-published" datetime="2024-02-26 18:20:04 -0400">Feb 26, 2024</time></a>

		<div class="e-content">
			 <p>This post explains how to create an Azure App Registration and configure it to provide your application access to only select SharePoint sites.</p>
<p>The Azure App Registration provides your application the permissions it needs to various sources, in this example, SharePoint. This eliminates the need to run your application using a user account.</p>
<p>In this specific example, rather than giving full control to all of SharePoint, we want our app to only have access to select SharePoint sites. We can use PowerShell to set exactly which sites we want the application to have permissions to.</p>
<h2 id="create-the-app-registration-in-azure">Create the App Registration in Azure</h2>
<p>Follow the following steps to create an Azure App Registration using a self-signed certificate.</p>
<ul>
<li>First, create a <a href="https://thepowerarchitect.com/2024/02/01/create-a-selfsigned.html">Self-signed Certificate using PowerShell</a>.</li>
<li>Save the .cer and .pfx files and the information used to create the certificate.</li>
<li>Create an Azure App Registration from <a href="https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps">Azure AD</a>.
<ul>
<li>Search for <code>App Registrations</code>, then click on the App Registrations result.</li>
<li>Click <code>New Registration</code>.</li>
<li>Enter a user-friendly name.</li>
<li>Select your Account types.</li>
<li>Click <code>Register</code>.</li>
</ul>
</li>
<li>Select <code>Certificates &amp; Secrets</code> in the left menu.</li>
<li>Upload the .cer file created earlier.</li>
<li>Select <code>API Permissions</code>.</li>
<li>Select <code>Add a permission</code>.</li>
<li>Select <code>SharePoint</code>.</li>
<li>Select <code>Application permissions</code>.</li>
<li>Select <code>Sites.Selected</code>.</li>
<li>Click the <code>Add Permissions</code> button to save.</li>
<li>As an administrator, click the <code>Grant admin consent for {Your Organization}</code>.</li>
<li>Click <code>Yes</code> to confirm.</li>
</ul>
<p>Next, you&rsquo;ll use the PowerShell below to set which SharePoint sites the App Registration is allowed to access.</p>
<h2 id="grant-permissions-to-select-sites-using-powershell">Grant permissions to select sites using PowerShell</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$targetSiteUrl = <span style="color:#960050;background-color:#1e0010">‘</span>{sharepoint site url}<span style="color:#960050;background-color:#1e0010">’</span>
</span></span><span style="display:flex;"><span>Connect-PnPOnline $targetSiteUrl -Interactive
</span></span><span style="display:flex;"><span>Grant-PnPAzureADAppSitePermission -AppId <span style="color:#960050;background-color:#1e0010">‘</span>{app (client) id}<span style="color:#960050;background-color:#1e0010">’</span> -DisplayName <span style="color:#960050;background-color:#1e0010">‘</span>{app display name}<span style="color:#960050;background-color:#1e0010">’</span> -Site $targetSiteUrl -Permissions Write
</span></span></code></pre></div><h2 id="get-site-permission-for-a-selected-site">Get site permission for a selected site</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>Get-PnPAzureADAppSitePermission -Site $targetSiteUrl
</span></span></code></pre></div><h2 id="revoke-permission-via-powershell">Revoke Permission via PowerShell</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$targetSiteUrl = <span style="color:#e6db74">&#39;{sharepoint site url}&#39;</span>
</span></span><span style="display:flex;"><span>Connect-PnPOnline $targetSiteUrl -Interactive
</span></span><span style="display:flex;"><span>Revoke-PnPAzureADAppSitePermission -PermissionId <span style="color:#e6db74">&#39;{permissionid}&#39;</span> -Site $targetSiteUrl -Force
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Get-PnPAzureADAppSitePermission -Site $targetSiteUrl
</span></span></code></pre></div>
		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://eg-architect.micro.blog/2024/02/23/converting-from-utc.html">Converting from UTC in Power Apps</a></h1>
		

		<a href="https://eg-architect.micro.blog/2024/02/23/converting-from-utc.html" class="u-url"><time class="dt-published" datetime="2024-02-23 17:58:28 -0400">Feb 23, 2024</time></a>

		<div class="e-content">
			 <p>We can use the TimeZoneOffset function in Power Apps to adjust for the current time zone from UTC time. We would typically want to save our Dates as UTC time in any database we&rsquo;re using, and convert those dates to the local time zone when viewing them in our app.</p>
<p>This example, takes the date value named <code>StartTime</code>, which is a UTC time, and subtracts the TimeZoneOffset value in minutes to get the local time.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">DateAdd(</span> <span style="color:#960050;background-color:#1e0010">StartTime,</span> <span style="color:#960050;background-color:#1e0010">−TimeZoneOffset(</span> <span style="color:#960050;background-color:#1e0010">StartTime</span> <span style="color:#960050;background-color:#1e0010">),</span> <span style="color:#960050;background-color:#1e0010">TimeUnit.Minutes</span> <span style="color:#960050;background-color:#1e0010">)</span>
</span></span></code></pre></div><p><a href="https://learn.microsoft.com/en-us/power-platform/power-fx/reference/function-dateadd-datediff">DateAdd, DateDiff, and TimeZoneOffset functions - Power Platform | Microsoft Learn</a></p>

		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://eg-architect.micro.blog/2024/02/23/working-with-checkbox.html">Working with Checkbox controls in a Power Apps Gallery</a></h1>
		

		<a href="https://eg-architect.micro.blog/2024/02/23/working-with-checkbox.html" class="u-url"><time class="dt-published" datetime="2024-02-23 09:16:34 -0400">Feb 23, 2024</time></a>

		<div class="e-content">
			 <p>Handling checkboxes can be tricky and does not always work as expected. Using a collection is a simple and robust solution. For this demo, let&rsquo;s set up a Gallery with checkbox controls to demonstrate various ways to interact with them.</p>
<p><img src="https://eg-architect.micro.blog/uploads/2024/working-with-checkbox-controls-in-a-power-apps-gallery-20231127111219445.we.webp" alt="Example Gallery with Checkboxes"></p>
<h2 id="load-the-data">Load the Data</h2>
<p>Add a button and update the OnSelect property to create a data collection.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">ClearCollect</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">colSampleFood</span>,
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">GUID</span>(),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Pizza&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SelectedFood</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">GUID</span>(),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Hamburgers&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SelectedFood</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">GUID</span>(),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Hotdogs&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SelectedFood</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">GUID</span>(),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Chicken&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SelectedFood</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h2 id="configure-your-gallery">Configure Your Gallery</h2>
<p>Set the <strong>Gallery.Items</strong> property to the name of your collection.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">colSampleFood</span>
</span></span></code></pre></div><p>In your Gallery template, add a checkbox control. Set the Text property to the current title (<code>ThisItem.Title</code>). Set the Default property to <code>ThisItem.SelectedFood</code>. Adjust the size and layout of your template as needed. Your Gallery should display your data when you click the <code>Load Collection</code> button.</p>
<h2 id="add-a-datatable-control-optional">Add a DataTable control (Optional)</h2>
<p>To easily view the data in my collection without digging through the data sources or the formula bar, I add a DataTable control to the screen and delete it afterward. To do this, set the Items property of the DataTable control to your collection colSampleFood and add all fields to the control. This will give you a live preview of the data in your collection. See the screenshot above to see how mine looks for this demo.</p>
<h2 id="save-your-gallery-checkbox-state">Save your Gallery Checkbox state</h2>
<p>Add a Save button to your screen. Set the <code>OnSelect</code> property to the formula below. When the button is clicked, we will Patch the colSampleFood collection for each item in the Gallery with the checkbox value for that record.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">ForAll</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">galDemo</span>.<span style="color:#a6e22e">AllItems</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Patch</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">colSampleFood</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ThisRecord</span>,
</span></span><span style="display:flex;"><span>        {<span style="color:#a6e22e">SelectedFood</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cbIsSelected</span>.<span style="color:#a6e22e">Value</span>}
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>If you added the <strong>DataTable</strong> control above, then when you click Save you should see the <strong>SelectedFood</strong> property update and match the selected values of your checkboxes.</p>
<h2 id="select-all-checkboxes-in-the-gallery">Select all checkboxes in the Gallery</h2>
<p>A common scenario is to have a button or link on the screen that, when clicked, checks all of the checkboxes in the Gallery.</p>
<p>One way to do this is to immediately use the OnCheck and OnUnCheck properties of the Checkbox control and patch the current item in the collection. This usually works, but I&rsquo;ve had issues patching the collection from within the Gallery for other field types and larger collections, so I avoid it.</p>
<p>I found an easy way to select all to update the collection directly using the <a href="https://learn.microsoft.com/en-us/power-platform/power-fx/reference/function-update-updateif?ref=thepowerarchitect.com">UpdateIf</a> function. Add the code below in the OnSelect property of your Select All button. It will update the colSampleFood collection, setting all unchecked items to checked. Since your Gallery uses the collection as its data source, it will update automatically.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">UpdateIf</span>( <span style="color:#a6e22e">colSampleFood</span>, <span style="color:#a6e22e">Not</span>(<span style="color:#a6e22e">SelectedFood</span>), {<span style="color:#a6e22e">SelectedFood</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>} )
</span></span></code></pre></div><h2 id="unselect-all-checkboxes-in-the-gallery">Unselect all checkboxes in the Gallery</h2>
<p>Unselecting all checkboxes, as you would expect, is similar to when we select them all. In the <strong>OnSelect</strong> property of the <strong>Unselect All</strong> button, add this code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">UpdateIf</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">colSampleFood</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">SelectedFood</span>,
</span></span><span style="display:flex;"><span>    {<span style="color:#a6e22e">SelectedFood</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>}
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>Conclusion</p>
<p>In this post, we learned how to add a Checkbox control to a Gallery, save the selected state of the checkbox, select all items, and unselect all items.</p>

		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://eg-architect.micro.blog/2024/02/18/microsoft-power-automate.html">Microsoft Power Automate Approval Types</a></h1>
		

		<a href="https://eg-architect.micro.blog/2024/02/18/microsoft-power-automate.html" class="u-url"><time class="dt-published" datetime="2024-02-18 09:00:00 -0400">Feb 18, 2024</time></a>

		<div class="e-content">
			 <p>Microsoft Power Automate has two main Approval Types.</p>
<ol>
<li>Everyone must approve - All approvers must approve.</li>
<li>First to respond - Requires approval from one approver.</li>
</ol>
<h2 id="first-to-respond">First to respond</h2>
<p><img src="https://eg-architect.micro.blog/uploads/2024/6a76716952.jpg" alt="First to Respond"></p>
<p>When one approver approves (or rejects), their approval task is marked as Approved (or Rejected) and moved to history. The approval tasks for the other Approvers are also marked as Approved (or Rejected) and moved to history. If any approvers look at that approval task, it will show a message saying the task has already been completed. No notification is sent.</p>
<p>Only one approver must approve (or Reject).</p>
<h2 id="everyone-must-approve">Everyone must approve</h2>
<p><img src="https://eg-architect.micro.blog/uploads/2024/e785452218.jpg" alt="Everyone must approve"></p>
<p>When one approver approves, their approval task is marked as Approved and moved to history. The other approval tasks remain pending. All tasks must be approved before the workflow continues to the following action. However, if any approvers reject their task, all of the approval tasks are marked as Rejected and moved to history. Then, the following action in the workflow is triggered.</p>

		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://eg-architect.micro.blog/2024/02/14/validate-your-power.html">Validate your Power Automate Licenses</a></h1>
		

		<a href="https://eg-architect.micro.blog/2024/02/14/validate-your-power.html" class="u-url"><time class="dt-published" datetime="2024-02-14 09:52:06 -0400">Feb 14, 2024</time></a>

		<div class="e-content">
			 <p>Microsoft has provided some PowerShell that allows admins to check their Power Platform Environments for invalid Microsoft Power Automate Licenses before it becomes an issue.</p>
<blockquote>
<p>Unlicensed Power Automate Flows will be turned off. Microsoft is enforcing licensing on all Power Automate flows. The flow owner will be notified if any of your flows do not meet licensing requirements. The flow will turn off if not compliant after x days. Read the <a href="https://learn.microsoft.com/en-us/power-platform/admin/power-automate-licensing/faqs">FAQ</a> for licensing details.</p>
</blockquote>
<h2 id="open-powershell">Open PowerShell</h2>
<p>First, open PowerShell on your machine (search for PowerShell), then open it as an administrator.</p>
<h2 id="browse-to-a-location-to-save-the-output">Browse to a location to save the output</h2>
<p>Next, enter <code>CD</code> and then the path to where you want to export the results. For me, my path is <code>C:\Local\Licensing</code>. Click Enter to see your directory change in your PowerShell prompt.</p>
<h2 id="install-the-modules">Install the modules</h2>
<p>We need to install the PowerShell modules required to run our command.</p>
<p>Copy the following into your PowerShell terminal and click Enter.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Install-Module -Name Microsoft.PowerApps.Administration.PowerShell -Force  
</span></span><span style="display:flex;"><span>Install-Module -Name Microsoft.PowerApps.PowerShell -AllowClobber -Force
</span></span></code></pre></div><h2 id="run-get-adminflowatriskofsuspension">Run Get-AdminFlowAtRiskOfSuspension</h2>
<p>Now, we can run our command. The command will check if any Power Automate flows in this environment are at risk and download the CSV file you specify.</p>
<p>Please copy the following PowerShell, but change the Environment Name and, optionally, the Path before running it. I’d do this in Notepad first, then copy the results into the PowerShell terminal.</p>
<blockquote>
<p>Find your Environment Name You can find your environment by visiting the <a href="https://admin.powerplatform.microsoft.com/environments">Environments</a> page in the Power Platform Admin Center. I always click into the environment and use the Environment ID provided on the summary screen.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Get-AdminFlowAtRiskOfSuspension -EnvironmentName &lt;ENV_NAME&gt; -ApiVersion <span style="color:#e6db74">&#39;2016-11-01&#39;</span> | Export-Csv -Path suspensionList.csv -NoTypeInformation
</span></span></code></pre></div><p>When you run this command, it will open a window that asks you to authenticate to your SharePoint tenant.</p>
<p>After logging in, the results should be exported to a CSV file in the path you navigated earlier.</p>
<h2 id="read-your-results">Read your results</h2>
<p>If your CSV file is empty, you should be good to go. <strong>Remember to check each of your environments!</strong></p>
<p>If you have results in your CSV, unfortunately, that means you have some invalid licenses to deal with.</p>
<p>Your CSV file will have all the details you need to identify the flow, why it was flagged, and recommendations to resolve the licensing issue.</p>
<h2 id="how-to-resolve-licensing-issues">How to resolve licensing issues</h2>
<p>The best option is to read the <a href="https://learn.microsoft.com/en-us/power-platform/admin/power-automate-licensing/faqs">FAQ</a> provided by Microsoft.</p>
<p>If your Flow is created to support your Power App, you can <a href="https://learn.microsoft.com/en-us/power-automate/associate-flow-to-app">Associate Your Flow</a>, with your Power App. This assumes your flow runs in the app’s context and uses the same data sources for triggers or actions. Scheduled and automated cloud flows must be linked to the app through <a href="https://learn.microsoft.com/en-us/power-platform/admin/powerapps-powershell#associate-in-context-flows-to-an-app">PowerShell</a>, but others can be connected directly from the flow details page (see bottom-right corner).</p>

		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://eg-architect.micro.blog/2024/02/01/create-a-selfsigned.html">Create a self-signed Certificate using PowerShell</a></h1>
		

		<a href="https://eg-architect.micro.blog/2024/02/01/create-a-selfsigned.html" class="u-url"><time class="dt-published" datetime="2024-02-01 09:00:00 -0400">Feb 1, 2024</time></a>

		<div class="e-content">
			 <p>Run the following PowerShell to create a self-signed certificate using Windows and PowerShell. Useful for creating certificates to use in Azure App Registrations.</p>
<ul>
<li>Open Windows PowerShell ISE as an administrator.</li>
<li>Copy and paste the PowerShell below into the editor.</li>
<li>Use the <code>cd</code> command to change to a directory of your choice where you want to save the certificate files.</li>
<li>Execute the code. You will be prompted for several input parameters.
<ul>
<li>CommonName: Give your certificate a name you will recognize.</li>
<li>StartDate: The date your certificate will become valid.</li>
<li>EndDate: The date your certificate should expire.</li>
<li>Password: A unique password for your certificate.</li>
<li>Press enter.
You&rsquo;ll end up with something like this. In my case, the <code>.cer</code> and <code>.pfx</code> files were saved to c:\local.</li>
</ul>
</li>
</ul>
<p><img src="https://eg-architect.micro.blog/uploads/2024/8b24e4ea0b.png" alt="A screenshot of the results from running the provided PowerShell."></p>
<p>Here is the script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#66d9ef">Param</span>(
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   [Parameter(<span style="color:#a6e22e">Mandatory</span>=$true)]
</span></span><span style="display:flex;"><span>   [<span style="color:#66d9ef">string</span>]$CommonName,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   [Parameter(<span style="color:#a6e22e">Mandatory</span>=$true)]
</span></span><span style="display:flex;"><span>   [<span style="color:#66d9ef">DateTime</span>]$StartDate,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   [Parameter(<span style="color:#a6e22e">Mandatory</span>=$true)]
</span></span><span style="display:flex;"><span>   [<span style="color:#66d9ef">DateTime</span>]$EndDate,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   [Parameter(<span style="color:#a6e22e">Mandatory</span>=$false, <span style="color:#a6e22e">HelpMessage</span>=<span style="color:#e6db74">&#34;Will overwrite existing certificates&#34;</span>)]
</span></span><span style="display:flex;"><span>   [<span style="color:#66d9ef">Switch</span>]$Force,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   [Parameter(<span style="color:#a6e22e">Mandatory</span>=$false)]
</span></span><span style="display:flex;"><span>   [<span style="color:#66d9ef">SecureString</span>]$Password
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DO NOT MODIFY BELOW</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> CreateSelfSignedCertificate(){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#Remove and existing certificates with the same common name from personal and root stores</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#Need to be very wary of this as could break something</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>($CommonName.ToLower().StartsWith(<span style="color:#e6db74">&#34;cn=&#34;</span>))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Remove CN from common name</span>
</span></span><span style="display:flex;"><span>        $CommonName = $CommonName.Substring(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    $certs = Get-ChildItem -Path Cert<span style="color:#960050;background-color:#1e0010">:</span>\LocalMachine\my | Where-Object{$_.Subject <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;CN=</span>$CommonName<span style="color:#e6db74">&#34;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>($certs <span style="color:#f92672">-ne</span> $null <span style="color:#f92672">-and</span> $certs.Length <span style="color:#f92672">-gt</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>($Force)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">foreach</span>($c <span style="color:#66d9ef">in</span> $certs)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                remove-item $c.PSPath
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            Write-Host -ForegroundColor Red <span style="color:#e6db74">&#34;One or more certificates with the same common name (CN=</span>$CommonName<span style="color:#e6db74">) are already located in the local certificate store. Use -Force to remove them&#34;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> $false
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    $name = new-object -com <span style="color:#e6db74">&#34;X509Enrollment.CX500DistinguishedName.1&#34;</span>
</span></span><span style="display:flex;"><span>    $name.Encode(<span style="color:#e6db74">&#34;CN=</span>$CommonName<span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    $key = new-object -com <span style="color:#e6db74">&#34;X509Enrollment.CX509PrivateKey.1&#34;</span>
</span></span><span style="display:flex;"><span>    $key.ProviderName = <span style="color:#e6db74">&#34;Microsoft RSA SChannel Cryptographic Provider&#34;</span>
</span></span><span style="display:flex;"><span>    $key.KeySpec = <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    $key.Length = <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>    $key.SecurityDescriptor = <span style="color:#e6db74">&#34;D:PAI(A;;0xd01f01ff;;;SY)(A;;0xd01f01ff;;;BA)(A;;0x80120089;;;NS)&#34;</span>
</span></span><span style="display:flex;"><span>    $key.MachineContext = <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    $key.ExportPolicy = <span style="color:#ae81ff">1</span> <span style="color:#75715e"># This is required to allow the private key to be exported</span>
</span></span><span style="display:flex;"><span>    $key.Create()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    $serverauthoid = new-object -com <span style="color:#e6db74">&#34;X509Enrollment.CObjectId.1&#34;</span>
</span></span><span style="display:flex;"><span>    $serverauthoid.InitializeFromValue(<span style="color:#e6db74">&#34;1.3.6.1.5.5.7.3.1&#34;</span>) <span style="color:#75715e"># Server Authentication</span>
</span></span><span style="display:flex;"><span>    $ekuoids = new-object -com <span style="color:#e6db74">&#34;X509Enrollment.CObjectIds.1&#34;</span>
</span></span><span style="display:flex;"><span>    $ekuoids.add($serverauthoid)
</span></span><span style="display:flex;"><span>    $ekuext = new-object -com <span style="color:#e6db74">&#34;X509Enrollment.CX509ExtensionEnhancedKeyUsage.1&#34;</span>
</span></span><span style="display:flex;"><span>    $ekuext.InitializeEncode($ekuoids)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    $cert = new-object -com <span style="color:#e6db74">&#34;X509Enrollment.CX509CertificateRequestCertificate.1&#34;</span>
</span></span><span style="display:flex;"><span>    $cert.InitializeFromPrivateKey(<span style="color:#ae81ff">2</span>, $key, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    $cert.Subject = $name
</span></span><span style="display:flex;"><span>    $cert.Issuer = $cert.Subject
</span></span><span style="display:flex;"><span>    $cert.NotBefore = $StartDate
</span></span><span style="display:flex;"><span>    $cert.NotAfter = $EndDate
</span></span><span style="display:flex;"><span>    $cert.X509Extensions.Add($ekuext)
</span></span><span style="display:flex;"><span>    $cert.Encode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    $enrollment = new-object -com <span style="color:#e6db74">&#34;X509Enrollment.CX509Enrollment.1&#34;</span>
</span></span><span style="display:flex;"><span>    $enrollment.InitializeFromRequest($cert)
</span></span><span style="display:flex;"><span>    $certdata = $enrollment.CreateRequest(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    $enrollment.InstallResponse(<span style="color:#ae81ff">2</span>, $certdata, <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> $true
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> ExportPFXFile()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>($CommonName.ToLower().StartsWith(<span style="color:#e6db74">&#34;cn=&#34;</span>))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Remove CN from common name</span>
</span></span><span style="display:flex;"><span>        $CommonName = $CommonName.Substring(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>($Password <span style="color:#f92672">-eq</span> $null)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $Password = Read-Host -Prompt <span style="color:#e6db74">&#34;Enter Password to protect private key&#34;</span> -AsSecureString
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    $cert = Get-ChildItem -Path Cert<span style="color:#960050;background-color:#1e0010">:</span>\LocalMachine\my | where-object{$_.Subject <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;CN=</span>$CommonName<span style="color:#e6db74">&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Export-PfxCertificate -Cert $cert -Password $Password -FilePath <span style="color:#e6db74">&#34;</span>$($CommonName)<span style="color:#e6db74">.pfx&#34;</span>
</span></span><span style="display:flex;"><span>    Export-Certificate -Cert $cert -Type CERT -FilePath <span style="color:#e6db74">&#34;</span>$CommonName<span style="color:#e6db74">.cer&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> RemoveCertsFromStore()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Once the certificates have been been exported we can safely remove them from the store</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>($CommonName.ToLower().StartsWith(<span style="color:#e6db74">&#34;cn=&#34;</span>))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Remove CN from common name</span>
</span></span><span style="display:flex;"><span>        $CommonName = $CommonName.Substring(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    $certs = Get-ChildItem -Path Cert<span style="color:#960050;background-color:#1e0010">:</span>\LocalMachine\my | Where-Object{$_.Subject <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;CN=</span>$CommonName<span style="color:#e6db74">&#34;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>($c <span style="color:#66d9ef">in</span> $certs)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        remove-item $c.PSPath
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">if</span>(CreateSelfSignedCertificate)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    ExportPFXFile
</span></span><span style="display:flex;"><span>    RemoveCertsFromStore
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://eg-architect.micro.blog/2024/01/30/infopath-end-of.html">InfoPath 2013 End of Support</a></h1>
		

		<a href="https://eg-architect.micro.blog/2024/01/30/infopath-end-of.html" class="u-url"><time class="dt-published" datetime="2024-01-30 10:00:00 -0400">Jan 30, 2024</time></a>

		<div class="e-content">
			 <p>InfoPath 2013 client and InfoPath Forms Services in SharePoint Online will end support in July 2026.</p>
<p>There is an <a href="https://pnp.github.io/pnpassessment/infopath/readme.html">InfoPath Forms Services Assessment tool</a> that can help identify and evaluate usage on your tenant.</p>
<blockquote>
<p>The Microsoft 365 Assessment Tool helps you identify and evaluate the InfoPath Forms Services usage on your tenant by providing you the <a href="https://pnp.github.io/pnpassessment/infopath/assess.html">usage data of InfoPath Forms Services</a>, and generating a <a href="https://pnp.github.io/pnpassessment/infopath/report-intro.html">Power BI report</a> to help plan migrating InfoPath Forms Services usage to Power Apps, Power Automate, Forms or other supported solutions.</p>
</blockquote>

		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://eg-architect.micro.blog/2024/01/16/the-power-apps.html">The Power Apps With Function</a></h1>
		

		<a href="https://eg-architect.micro.blog/2024/01/16/the-power-apps.html" class="u-url"><time class="dt-published" datetime="2024-01-16 09:35:00 -0400">Jan 16, 2024</time></a>

		<div class="e-content">
			 <p>The Microsoft Power Apps <a href="https://learn.microsoft.com/en-us/power-platform/power-fx/reference/function-with">With function</a> is a powerful way to divide complex formulas into smaller pieces. It is useful when used within a ForAll, since we can’t set variables within a ForAll. Since the formula is contained, it is preferred over context variables created using UpdateContext or global variables created using Set.</p>
<p>The syntax looks like this:</p>
<pre tabindex="0"><code>With(
 { 
   myValue1: //add some logic
 },
 //Do something with the myValue1result
)
</code></pre><p>You can also have nested With functions.</p>
<pre tabindex="0"><code>With(
 { 
   myValue1: //add some logic
 },
  With(
  {
   myValue2: // do something with myValue1
  },
  //Do something with myValue2
)
</code></pre><p>Or even run the With function within a ForAll. You can also run ForEach within the With function itself.</p>
<pre tabindex="0"><code>ForAll(galMyItems.AllItems As galSelectedItem, 
 With(
 {
   myValue1: //add some logic with galSelectedItem
 },
 //Do something with the myValue1result
 )
)
</code></pre>
		</div>
	  </div>
	
	  <div class="h-entry">
		
			<h1><a href="https://eg-architect.micro.blog/2024/01/12/validate-email-addresses.html">Validate Email Addresses in Power Apps</a></h1>
		

		<a href="https://eg-architect.micro.blog/2024/01/12/validate-email-addresses.html" class="u-url"><time class="dt-published" datetime="2024-01-12 09:32:00 -0400">Jan 12, 2024</time></a>

		<div class="e-content">
			 <p>A common request when building Power Apps is to validate the email address of a textbox. This can be done easily using the <a href="https://learn.microsoft.com/en-us/power-platform/power-fx/reference/function-ismatch?ref=thepowerarchitect.com">IsMatch</a> function. The function also does all kinds of validation using regular expressions. The Match.Email property can be used to check if it’s a valid email automatically.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">If</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">IsMatch</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">txtValidationEmail</span>.<span style="color:#a6e22e">Text</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Match</span>.<span style="color:#a6e22e">Email</span>
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">true</span> <span style="color:#75715e">// The email address is valid
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">false</span> <span style="color:#75715e">// The email address is not valid
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>)
</span></span></code></pre></div><p>Here is an example of a TextInput and Icon control on the screen. The icon control shows a red error icon if the email is invalid and a green checkbox if it is valid.</p>
<!-- raw HTML omitted -->
<p>The text is not a valid email address and shows the red error icon.</p>
<!-- raw HTML omitted -->
<p>In the Icons <code>Icon</code> property, add the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">If</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">IsMatch</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">txtValidationEmail</span>.<span style="color:#a6e22e">Text</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Match</span>.<span style="color:#a6e22e">Email</span>
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Icon</span>.<span style="color:#a6e22e">CheckBadge</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Icon</span>.Error
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>Now, in the Icon’s <code>Color</code> property, add the following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">If</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Self</span>.<span style="color:#a6e22e">Icon</span><span style="color:#f92672">=</span><span style="color:#a6e22e">Icon</span>.Error,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">RGBA</span>(<span style="color:#ae81ff">168</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">RGBA</span>(<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">198</span>,<span style="color:#ae81ff">63</span>,<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div>
		</div>
	  </div>
	

</div>


    
    <br>
<strong>What's next?</strong>
<div>
Explore the site by checking out some <a href="/surprise-me">random posts</a>,  or <a href="/search">search</a> for something specific. If I was helpful, you could buy me a <a href="https://ko-fi.com/ericgregorich">coffee</a>.  
</div>
<hr>
<div>
<form
  action="https://buttondown.email/api/emails/embed-subscribe/thepowerarchitect"
  method="post"
  target="popupwindow"
  onsubmit="window.open('https://buttondown.email/thepowerarchitect', 'popupwindow')"
  class="embeddable-buttondown-form"
>
  <label for="bd-email">Enter your email</label>
  <input type="email" name="email" id="bd-email" />
  
  <input type="submit" value="Subscribe" />
  <p>
    <a href="https://buttondown.email/refer/thepowerarchitect" target="_blank">Powered by Buttondown.</a>
  </p>
</form>
</div>
<hr>
<br>

<div class="footer-links">
<a title="RSS" href="/feed.xml"><i class="fa-solid fa-rss"></i></a> 
<a title="Micro.blog" href="https://micro.blog/thepowerarchitect"><i class="fa-brands fa-microblog"></i></a>  
</div>
<br>

<div style="font-size: 12px">
Powered by <a href="https://micro.blog">Micro.blog</a> and the <a href="https://cards.ericgregorich.com/">Cards Theme</a>
</div>
<br>

<script src="https://tinylytics.app/embed/ruxeC3Pyu13ozgzu_1sz.js?kudos=🩷" defer></script>

  </body>

</html>
